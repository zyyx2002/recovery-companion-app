{"dependencies":[{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"]}},{"name":"../utils/useAuth","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":48,"index":48}}],"key":"EgKBBBoILbhJ+j84XRMkK1sNXv8=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n  var _env2 = require(_dependencyMap[0], \"expo/virtual/env\");\n  var _useAuth = require(_dependencyMap[1], \"../utils/useAuth\");\n  const originalFetch = fetch;\n  const getURLFromArgs = (...args) => {\n    const [urlArg] = args;\n    let url;\n    if (typeof urlArg === 'string') {\n      url = urlArg;\n    } else if (typeof urlArg === 'object' && urlArg !== null) {\n      url = urlArg.url;\n    } else {\n      url = null;\n    }\n    return url;\n  };\n  const isFirstPartyURL = url => {\n    return url.startsWith('/') || _env2.env.EXPO_PUBLIC_BASE_URL && url.startsWith(_env2.env.EXPO_PUBLIC_BASE_URL);\n  };\n  const isSecondPartyURL = url => {\n    return url.startsWith('/_create/');\n  };\n  const fetchToWeb = async function fetchWithHeaders(...args) {\n    const firstPartyURL = _env2.env.EXPO_PUBLIC_BASE_URL;\n    const secondPartyURL = _env2.env.EXPO_PUBLIC_PROXY_BASE_URL;\n    if (!firstPartyURL || !secondPartyURL) {\n      return originalFetch(...args);\n    }\n    const [input, init] = args;\n    const url = getURLFromArgs(input, init);\n    if (!url) {\n      return originalFetch(input, init);\n    }\n    const isExternalFetch = !isFirstPartyURL(url);\n    // we should not add headers to requests that don't go to our own server\n    if (isExternalFetch) {\n      return originalFetch(input, init);\n    }\n    let finalInput = input;\n    const baseURL = isSecondPartyURL(url) ? secondPartyURL : firstPartyURL;\n    if (typeof input === 'string') {\n      finalInput = input.startsWith('/') ? `${baseURL}${input}` : input;\n    } else if (input instanceof Request) {\n      const requestUrl = input.url.startsWith('/') ? `${baseURL}${input.url}` : input.url;\n      finalInput = new Request(requestUrl, input);\n    }\n    const initHeaders = init?.headers ?? {};\n    const finalHeaders = new Headers(initHeaders);\n    const auth = _useAuth.useAuthStore.getState().auth;\n    if (auth) {\n      finalHeaders.set('authorization', `Bearer ${auth.jwt}`);\n    }\n    return originalFetch(finalInput, {\n      ...init,\n      headers: finalHeaders\n    });\n  };\n  var _default = exports.default = fetchToWeb;\n});","lineCount":63,"map":[[7,2,1,0],[7,6,1,0,"_useAuth"],[7,14,1,0],[7,17,1,0,"require"],[7,24,1,0],[7,25,1,0,"_dependencyMap"],[7,39,1,0],[8,2,3,0],[8,8,3,6,"originalFetch"],[8,21,3,19],[8,24,3,22,"fetch"],[8,29,3,27],[9,2,5,0],[9,8,5,6,"getURLFromArgs"],[9,22,5,20],[9,25,5,23,"getURLFromArgs"],[9,26,5,24],[9,29,5,27,"args"],[9,33,5,57],[9,38,5,62],[10,4,6,2],[10,10,6,8],[10,11,6,9,"urlArg"],[10,17,6,15],[10,18,6,16],[10,21,6,19,"args"],[10,25,6,23],[11,4,7,2],[11,8,7,6,"url"],[11,11,7,24],[12,4,8,2],[12,8,8,6],[12,15,8,13,"urlArg"],[12,21,8,19],[12,26,8,24],[12,34,8,32],[12,36,8,34],[13,6,9,4,"url"],[13,9,9,7],[13,12,9,10,"urlArg"],[13,18,9,16],[14,4,10,2],[14,5,10,3],[14,11,10,9],[14,15,10,13],[14,22,10,20,"urlArg"],[14,28,10,26],[14,33,10,31],[14,41,10,39],[14,45,10,43,"urlArg"],[14,51,10,49],[14,56,10,54],[14,60,10,58],[14,62,10,60],[15,6,11,4,"url"],[15,9,11,7],[15,12,11,10,"urlArg"],[15,18,11,16],[15,19,11,17,"url"],[15,22,11,20],[16,4,12,2],[16,5,12,3],[16,11,12,9],[17,6,13,4,"url"],[17,9,13,7],[17,12,13,10],[17,16,13,14],[18,4,14,2],[19,4,15,2],[19,11,15,9,"url"],[19,14,15,12],[20,2,16,0],[20,3,16,1],[21,2,18,0],[21,8,18,6,"isFirstPartyURL"],[21,23,18,21],[21,26,18,25,"url"],[21,29,18,36],[21,33,18,41],[22,4,19,2],[22,11,20,4,"url"],[22,14,20,7],[22,15,20,8,"startsWith"],[22,25,20,18],[22,26,20,19],[22,29,20,22],[22,30,20,23],[22,34,21,5,"_env2"],[22,39,21,5],[22,40,21,5,"env"],[22,43,21,5],[22,44,21,5,"EXPO_PUBLIC_BASE_URL"],[22,64,21,5],[22,68,21,41,"url"],[22,71,21,44],[22,72,21,45,"startsWith"],[22,82,21,55],[22,83,21,55,"_env2"],[22,88,21,55],[22,89,21,55,"env"],[22,92,21,55],[22,93,21,55,"EXPO_PUBLIC_BASE_URL"],[22,113,21,88],[22,114,21,90],[23,2,23,0],[23,3,23,1],[24,2,25,0],[24,8,25,6,"isSecondPartyURL"],[24,24,25,22],[24,27,25,26,"url"],[24,30,25,37],[24,34,25,42],[25,4,26,2],[25,11,26,9,"url"],[25,14,26,12],[25,15,26,13,"startsWith"],[25,25,26,23],[25,26,26,24],[25,37,26,35],[25,38,26,36],[26,2,27,0],[26,3,27,1],[27,2,29,0],[27,8,29,6,"fetchToWeb"],[27,18,29,16],[27,21,29,19],[27,36,29,34,"fetchWithHeaders"],[27,52,29,50,"fetchWithHeaders"],[27,53,29,51],[27,56,29,54,"args"],[27,60,29,84],[27,62,29,86],[28,4,30,2],[28,10,30,8,"firstPartyURL"],[28,23,30,21],[28,26,30,21,"_env2"],[28,31,30,21],[28,32,30,21,"env"],[28,35,30,21],[28,36,30,21,"EXPO_PUBLIC_BASE_URL"],[28,56,30,56],[29,4,31,2],[29,10,31,8,"secondPartyURL"],[29,24,31,22],[29,27,31,22,"_env2"],[29,32,31,22],[29,33,31,22,"env"],[29,36,31,22],[29,37,31,22,"EXPO_PUBLIC_PROXY_BASE_URL"],[29,63,31,63],[30,4,32,2],[30,8,32,6],[30,9,32,7,"firstPartyURL"],[30,22,32,20],[30,26,32,24],[30,27,32,25,"secondPartyURL"],[30,41,32,39],[30,43,32,41],[31,6,33,4],[31,13,33,11,"originalFetch"],[31,26,33,24],[31,27,33,25],[31,30,33,28,"args"],[31,34,33,32],[31,35,33,33],[32,4,34,2],[33,4,35,2],[33,10,35,8],[33,11,35,9,"input"],[33,16,35,14],[33,18,35,16,"init"],[33,22,35,20],[33,23,35,21],[33,26,35,24,"args"],[33,30,35,28],[34,4,36,2],[34,10,36,8,"url"],[34,13,36,11],[34,16,36,14,"getURLFromArgs"],[34,30,36,28],[34,31,36,29,"input"],[34,36,36,34],[34,38,36,36,"init"],[34,42,36,40],[34,43,36,41],[35,4,37,2],[35,8,37,6],[35,9,37,7,"url"],[35,12,37,10],[35,14,37,12],[36,6,38,4],[36,13,38,11,"originalFetch"],[36,26,38,24],[36,27,38,25,"input"],[36,32,38,30],[36,34,38,32,"init"],[36,38,38,36],[36,39,38,37],[37,4,39,2],[38,4,41,2],[38,10,41,8,"isExternalFetch"],[38,25,41,23],[38,28,41,26],[38,29,41,27,"isFirstPartyURL"],[38,44,41,42],[38,45,41,43,"url"],[38,48,41,46],[38,49,41,47],[39,4,42,2],[40,4,43,2],[40,8,43,6,"isExternalFetch"],[40,23,43,21],[40,25,43,23],[41,6,44,4],[41,13,44,11,"originalFetch"],[41,26,44,24],[41,27,44,25,"input"],[41,32,44,30],[41,34,44,32,"init"],[41,38,44,36],[41,39,44,37],[42,4,45,2],[43,4,47,2],[43,8,47,6,"finalInput"],[43,18,47,16],[43,21,47,19,"input"],[43,26,47,24],[44,4,48,2],[44,10,48,8,"baseURL"],[44,17,48,15],[44,20,48,18,"isSecondPartyURL"],[44,36,48,34],[44,37,48,35,"url"],[44,40,48,38],[44,41,48,39],[44,44,48,42,"secondPartyURL"],[44,58,48,56],[44,61,48,59,"firstPartyURL"],[44,74,48,72],[45,4,49,2],[45,8,49,6],[45,15,49,13,"input"],[45,20,49,18],[45,25,49,23],[45,33,49,31],[45,35,49,33],[46,6,50,4,"finalInput"],[46,16,50,14],[46,19,50,17,"input"],[46,24,50,22],[46,25,50,23,"startsWith"],[46,35,50,33],[46,36,50,34],[46,39,50,37],[46,40,50,38],[46,43,50,41],[46,46,50,44,"baseURL"],[46,53,50,51],[46,56,50,54,"input"],[46,61,50,59],[46,63,50,61],[46,66,50,64,"input"],[46,71,50,69],[47,4,51,2],[47,5,51,3],[47,11,51,9],[47,15,51,13,"input"],[47,20,51,18],[47,32,51,30,"Request"],[47,39,51,37],[47,41,51,39],[48,6,52,4],[48,12,52,10,"requestUrl"],[48,22,52,20],[48,25,52,23,"input"],[48,30,52,28],[48,31,52,29,"url"],[48,34,52,32],[48,35,52,33,"startsWith"],[48,45,52,43],[48,46,52,44],[48,49,52,47],[48,50,52,48],[48,53,52,51],[48,56,52,54,"baseURL"],[48,63,52,61],[48,66,52,64,"input"],[48,71,52,69],[48,72,52,70,"url"],[48,75,52,73],[48,77,52,75],[48,80,52,78,"input"],[48,85,52,83],[48,86,52,84,"url"],[48,89,52,87],[49,6,53,4,"finalInput"],[49,16,53,14],[49,19,53,17],[49,23,53,21,"Request"],[49,30,53,28],[49,31,53,29,"requestUrl"],[49,41,53,39],[49,43,53,41,"input"],[49,48,53,46],[49,49,53,47],[50,4,54,2],[51,4,56,2],[51,10,56,8,"initHeaders"],[51,21,56,19],[51,24,56,22,"init"],[51,28,56,26],[51,30,56,28,"headers"],[51,37,56,35],[51,41,56,39],[51,42,56,40],[51,43,56,41],[52,4,57,2],[52,10,57,8,"finalHeaders"],[52,22,57,20],[52,25,57,23],[52,29,57,27,"Headers"],[52,36,57,34],[52,37,57,35,"initHeaders"],[52,48,57,46],[52,49,57,47],[53,4,59,2],[53,10,59,8,"auth"],[53,14,59,12],[53,17,59,15,"useAuthStore"],[53,38,59,27],[53,39,59,28,"getState"],[53,47,59,36],[53,48,59,37],[53,49,59,38],[53,50,59,39,"auth"],[53,54,59,43],[54,4,60,2],[54,8,60,6,"auth"],[54,12,60,10],[54,14,60,12],[55,6,61,4,"finalHeaders"],[55,18,61,16],[55,19,61,17,"set"],[55,22,61,20],[55,23,61,21],[55,38,61,36],[55,40,61,38],[55,50,61,48,"auth"],[55,54,61,52],[55,55,61,53,"jwt"],[55,58,61,56],[55,60,61,58],[55,61,61,59],[56,4,62,2],[57,4,64,2],[57,11,64,9,"originalFetch"],[57,24,64,22],[57,25,64,23,"finalInput"],[57,35,64,33],[57,37,64,35],[58,6,65,4],[58,9,65,7,"init"],[58,13,65,11],[59,6,66,4,"headers"],[59,13,66,11],[59,15,66,13,"finalHeaders"],[60,4,67,2],[60,5,67,3],[60,6,67,4],[61,2,68,0],[61,3,68,1],[62,2,68,2],[62,6,68,2,"_default"],[62,14,68,2],[62,17,68,2,"exports"],[62,24,68,2],[62,25,68,2,"default"],[62,32,68,2],[62,35,70,15,"fetchToWeb"],[62,45,70,25],[63,0,70,25],[63,3]],"functionMap":{"names":["<global>","getURLFromArgs","isFirstPartyURL","isSecondPartyURL","fetchWithHeaders"],"mappings":"AAA;uBCI;CDW;wBEE;CFK;yBGE;CHE;mBIE;CJuC"}},"type":"js/module"}]}