{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"]}},{"name":"expo/virtual/env","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"dgHc21cgR+buKc7O3/dChhD5JJk=","exportNames":["*"]}},{"name":"../utils/useAuth","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":48,"index":48}}],"key":"EgKBBBoILbhJ+j84XRMkK1sNXv8=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _env2 = require(_dependencyMap[2], \"expo/virtual/env\");\n  var _useAuth = require(_dependencyMap[3], \"../utils/useAuth\");\n  var originalFetch = fetch;\n  var getURLFromArgs = function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    var urlArg = args[0];\n    var url;\n    if (typeof urlArg === 'string') {\n      url = urlArg;\n    } else if (typeof urlArg === 'object' && urlArg !== null) {\n      url = urlArg.url;\n    } else {\n      url = null;\n    }\n    return url;\n  };\n  var isFirstPartyURL = url => {\n    return url.startsWith('/') || _env2.env.EXPO_PUBLIC_BASE_URL && url.startsWith(_env2.env.EXPO_PUBLIC_BASE_URL);\n  };\n  var isSecondPartyURL = url => {\n    return url.startsWith('/_create/');\n  };\n  var fetchToWeb = /*#__PURE__*/function () {\n    var _fetchWithHeaders = (0, _asyncToGenerator2.default)(function* () {\n      var firstPartyURL = _env2.env.EXPO_PUBLIC_BASE_URL;\n      var secondPartyURL = _env2.env.EXPO_PUBLIC_PROXY_BASE_URL;\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n      if (!firstPartyURL || !secondPartyURL) {\n        return originalFetch(...args);\n      }\n      var input = args[0],\n        init = args[1];\n      var url = getURLFromArgs(input, init);\n      if (!url) {\n        return originalFetch(input, init);\n      }\n      var isExternalFetch = !isFirstPartyURL(url);\n      // we should not add headers to requests that don't go to our own server\n      if (isExternalFetch) {\n        return originalFetch(input, init);\n      }\n      var finalInput = input;\n      var baseURL = isSecondPartyURL(url) ? secondPartyURL : firstPartyURL;\n      if (typeof input === 'string') {\n        finalInput = input.startsWith('/') ? `${baseURL}${input}` : input;\n      } else if (input instanceof Request) {\n        var requestUrl = input.url.startsWith('/') ? `${baseURL}${input.url}` : input.url;\n        finalInput = new Request(requestUrl, input);\n      }\n      var initHeaders = init?.headers ?? {};\n      var finalHeaders = new Headers(initHeaders);\n      var auth = _useAuth.useAuthStore.getState().auth;\n      if (auth) {\n        finalHeaders.set('authorization', `Bearer ${auth.jwt}`);\n      }\n      return originalFetch(finalInput, {\n        ...init,\n        headers: finalHeaders\n      });\n    });\n    function fetchWithHeaders() {\n      return _fetchWithHeaders.apply(this, arguments);\n    }\n    return fetchWithHeaders;\n  }();\n  var _default = exports.default = fetchToWeb;\n});","lineCount":78,"map":[[9,2,1,0],[9,6,1,0,"_useAuth"],[9,14,1,0],[9,17,1,0,"require"],[9,24,1,0],[9,25,1,0,"_dependencyMap"],[9,39,1,0],[10,2,3,0],[10,6,3,6,"originalFetch"],[10,19,3,19],[10,22,3,22,"fetch"],[10,27,3,27],[11,2,5,0],[11,6,5,6,"getURLFromArgs"],[11,20,5,20],[11,23,5,23],[11,32,5,23,"getURLFromArgs"],[11,33,5,23],[11,35,5,62],[12,4,5,62],[12,13,5,62,"_len"],[12,17,5,62],[12,20,5,62,"arguments"],[12,29,5,62],[12,30,5,62,"length"],[12,36,5,62],[12,38,5,27,"args"],[12,42,5,31],[12,49,5,31,"Array"],[12,54,5,31],[12,55,5,31,"_len"],[12,59,5,31],[12,62,5,31,"_key"],[12,66,5,31],[12,72,5,31,"_key"],[12,76,5,31],[12,79,5,31,"_len"],[12,83,5,31],[12,85,5,31,"_key"],[12,89,5,31],[13,6,5,27,"args"],[13,10,5,31],[13,11,5,31,"_key"],[13,15,5,31],[13,19,5,31,"arguments"],[13,28,5,31],[13,29,5,31,"_key"],[13,33,5,31],[14,4,5,31],[15,4,6,2],[15,8,6,9,"urlArg"],[15,14,6,15],[15,17,6,19,"args"],[15,21,6,23],[16,4,7,2],[16,8,7,6,"url"],[16,11,7,24],[17,4,8,2],[17,8,8,6],[17,15,8,13,"urlArg"],[17,21,8,19],[17,26,8,24],[17,34,8,32],[17,36,8,34],[18,6,9,4,"url"],[18,9,9,7],[18,12,9,10,"urlArg"],[18,18,9,16],[19,4,10,2],[19,5,10,3],[19,11,10,9],[19,15,10,13],[19,22,10,20,"urlArg"],[19,28,10,26],[19,33,10,31],[19,41,10,39],[19,45,10,43,"urlArg"],[19,51,10,49],[19,56,10,54],[19,60,10,58],[19,62,10,60],[20,6,11,4,"url"],[20,9,11,7],[20,12,11,10,"urlArg"],[20,18,11,16],[20,19,11,17,"url"],[20,22,11,20],[21,4,12,2],[21,5,12,3],[21,11,12,9],[22,6,13,4,"url"],[22,9,13,7],[22,12,13,10],[22,16,13,14],[23,4,14,2],[24,4,15,2],[24,11,15,9,"url"],[24,14,15,12],[25,2,16,0],[25,3,16,1],[26,2,18,0],[26,6,18,6,"isFirstPartyURL"],[26,21,18,21],[26,24,18,25,"url"],[26,27,18,36],[26,31,18,41],[27,4,19,2],[27,11,20,4,"url"],[27,14,20,7],[27,15,20,8,"startsWith"],[27,25,20,18],[27,26,20,19],[27,29,20,22],[27,30,20,23],[27,34,21,5,"_env2"],[27,39,21,5],[27,40,21,5,"env"],[27,43,21,5],[27,44,21,5,"EXPO_PUBLIC_BASE_URL"],[27,64,21,5],[27,68,21,41,"url"],[27,71,21,44],[27,72,21,45,"startsWith"],[27,82,21,55],[27,83,21,55,"_env2"],[27,88,21,55],[27,89,21,55,"env"],[27,92,21,55],[27,93,21,55,"EXPO_PUBLIC_BASE_URL"],[27,113,21,88],[27,114,21,90],[28,2,23,0],[28,3,23,1],[29,2,25,0],[29,6,25,6,"isSecondPartyURL"],[29,22,25,22],[29,25,25,26,"url"],[29,28,25,37],[29,32,25,42],[30,4,26,2],[30,11,26,9,"url"],[30,14,26,12],[30,15,26,13,"startsWith"],[30,25,26,23],[30,26,26,24],[30,37,26,35],[30,38,26,36],[31,2,27,0],[31,3,27,1],[32,2,29,0],[32,6,29,6,"fetchToWeb"],[32,16,29,16],[33,4,29,16],[33,8,29,16,"_fetchWithHeaders"],[33,25,29,16],[33,32,29,16,"_asyncToGenerator2"],[33,50,29,16],[33,51,29,16,"default"],[33,58,29,16],[33,60,29,19],[33,73,29,86],[34,6,30,2],[34,10,30,8,"firstPartyURL"],[34,23,30,21],[34,26,30,21,"_env2"],[34,31,30,21],[34,32,30,21,"env"],[34,35,30,21],[34,36,30,21,"EXPO_PUBLIC_BASE_URL"],[34,56,30,56],[35,6,31,2],[35,10,31,8,"secondPartyURL"],[35,24,31,22],[35,27,31,22,"_env2"],[35,32,31,22],[35,33,31,22,"env"],[35,36,31,22],[35,37,31,22,"EXPO_PUBLIC_PROXY_BASE_URL"],[35,63,31,63],[36,6,31,64],[36,15,31,64,"_len2"],[36,20,31,64],[36,23,31,64,"arguments"],[36,32,31,64],[36,33,31,64,"length"],[36,39,31,64],[36,41,29,54,"args"],[36,45,29,58],[36,52,29,58,"Array"],[36,57,29,58],[36,58,29,58,"_len2"],[36,63,29,58],[36,66,29,58,"_key2"],[36,71,29,58],[36,77,29,58,"_key2"],[36,82,29,58],[36,85,29,58,"_len2"],[36,90,29,58],[36,92,29,58,"_key2"],[36,97,29,58],[37,8,29,54,"args"],[37,12,29,58],[37,13,29,58,"_key2"],[37,18,29,58],[37,22,29,58,"arguments"],[37,31,29,58],[37,32,29,58,"_key2"],[37,37,29,58],[38,6,29,58],[39,6,32,2],[39,10,32,6],[39,11,32,7,"firstPartyURL"],[39,24,32,20],[39,28,32,24],[39,29,32,25,"secondPartyURL"],[39,43,32,39],[39,45,32,41],[40,8,33,4],[40,15,33,11,"originalFetch"],[40,28,33,24],[40,29,33,25],[40,32,33,28,"args"],[40,36,33,32],[40,37,33,33],[41,6,34,2],[42,6,35,2],[42,10,35,9,"input"],[42,15,35,14],[42,18,35,24,"args"],[42,22,35,28],[43,8,35,16,"init"],[43,12,35,20],[43,15,35,24,"args"],[43,19,35,28],[44,6,36,2],[44,10,36,8,"url"],[44,13,36,11],[44,16,36,14,"getURLFromArgs"],[44,30,36,28],[44,31,36,29,"input"],[44,36,36,34],[44,38,36,36,"init"],[44,42,36,40],[44,43,36,41],[45,6,37,2],[45,10,37,6],[45,11,37,7,"url"],[45,14,37,10],[45,16,37,12],[46,8,38,4],[46,15,38,11,"originalFetch"],[46,28,38,24],[46,29,38,25,"input"],[46,34,38,30],[46,36,38,32,"init"],[46,40,38,36],[46,41,38,37],[47,6,39,2],[48,6,41,2],[48,10,41,8,"isExternalFetch"],[48,25,41,23],[48,28,41,26],[48,29,41,27,"isFirstPartyURL"],[48,44,41,42],[48,45,41,43,"url"],[48,48,41,46],[48,49,41,47],[49,6,42,2],[50,6,43,2],[50,10,43,6,"isExternalFetch"],[50,25,43,21],[50,27,43,23],[51,8,44,4],[51,15,44,11,"originalFetch"],[51,28,44,24],[51,29,44,25,"input"],[51,34,44,30],[51,36,44,32,"init"],[51,40,44,36],[51,41,44,37],[52,6,45,2],[53,6,47,2],[53,10,47,6,"finalInput"],[53,20,47,16],[53,23,47,19,"input"],[53,28,47,24],[54,6,48,2],[54,10,48,8,"baseURL"],[54,17,48,15],[54,20,48,18,"isSecondPartyURL"],[54,36,48,34],[54,37,48,35,"url"],[54,40,48,38],[54,41,48,39],[54,44,48,42,"secondPartyURL"],[54,58,48,56],[54,61,48,59,"firstPartyURL"],[54,74,48,72],[55,6,49,2],[55,10,49,6],[55,17,49,13,"input"],[55,22,49,18],[55,27,49,23],[55,35,49,31],[55,37,49,33],[56,8,50,4,"finalInput"],[56,18,50,14],[56,21,50,17,"input"],[56,26,50,22],[56,27,50,23,"startsWith"],[56,37,50,33],[56,38,50,34],[56,41,50,37],[56,42,50,38],[56,45,50,41],[56,48,50,44,"baseURL"],[56,55,50,51],[56,58,50,54,"input"],[56,63,50,59],[56,65,50,61],[56,68,50,64,"input"],[56,73,50,69],[57,6,51,2],[57,7,51,3],[57,13,51,9],[57,17,51,13,"input"],[57,22,51,18],[57,34,51,30,"Request"],[57,41,51,37],[57,43,51,39],[58,8,52,4],[58,12,52,10,"requestUrl"],[58,22,52,20],[58,25,52,23,"input"],[58,30,52,28],[58,31,52,29,"url"],[58,34,52,32],[58,35,52,33,"startsWith"],[58,45,52,43],[58,46,52,44],[58,49,52,47],[58,50,52,48],[58,53,52,51],[58,56,52,54,"baseURL"],[58,63,52,61],[58,66,52,64,"input"],[58,71,52,69],[58,72,52,70,"url"],[58,75,52,73],[58,77,52,75],[58,80,52,78,"input"],[58,85,52,83],[58,86,52,84,"url"],[58,89,52,87],[59,8,53,4,"finalInput"],[59,18,53,14],[59,21,53,17],[59,25,53,21,"Request"],[59,32,53,28],[59,33,53,29,"requestUrl"],[59,43,53,39],[59,45,53,41,"input"],[59,50,53,46],[59,51,53,47],[60,6,54,2],[61,6,56,2],[61,10,56,8,"initHeaders"],[61,21,56,19],[61,24,56,22,"init"],[61,28,56,26],[61,30,56,28,"headers"],[61,37,56,35],[61,41,56,39],[61,42,56,40],[61,43,56,41],[62,6,57,2],[62,10,57,8,"finalHeaders"],[62,22,57,20],[62,25,57,23],[62,29,57,27,"Headers"],[62,36,57,34],[62,37,57,35,"initHeaders"],[62,48,57,46],[62,49,57,47],[63,6,59,2],[63,10,59,8,"auth"],[63,14,59,12],[63,17,59,15,"useAuthStore"],[63,38,59,27],[63,39,59,28,"getState"],[63,47,59,36],[63,48,59,37],[63,49,59,38],[63,50,59,39,"auth"],[63,54,59,43],[64,6,60,2],[64,10,60,6,"auth"],[64,14,60,10],[64,16,60,12],[65,8,61,4,"finalHeaders"],[65,20,61,16],[65,21,61,17,"set"],[65,24,61,20],[65,25,61,21],[65,40,61,36],[65,42,61,38],[65,52,61,48,"auth"],[65,56,61,52],[65,57,61,53,"jwt"],[65,60,61,56],[65,62,61,58],[65,63,61,59],[66,6,62,2],[67,6,64,2],[67,13,64,9,"originalFetch"],[67,26,64,22],[67,27,64,23,"finalInput"],[67,37,64,33],[67,39,64,35],[68,8,65,4],[68,11,65,7,"init"],[68,15,65,11],[69,8,66,4,"headers"],[69,15,66,11],[69,17,66,13,"finalHeaders"],[70,6,67,2],[70,7,67,3],[70,8,67,4],[71,4,68,0],[71,5,68,1],[72,4,68,1],[72,13,29,34,"fetchWithHeaders"],[72,29,29,50,"fetchWithHeaders"],[72,30,29,50],[73,6,29,50],[73,13,29,50,"_fetchWithHeaders"],[73,30,29,50],[73,31,29,50,"apply"],[73,36,29,50],[73,43,29,50,"arguments"],[73,52,29,50],[74,4,29,50],[75,4,29,50],[75,11,29,34,"fetchWithHeaders"],[75,27,29,50],[76,2,29,50],[76,5,68,1],[77,2,68,2],[77,6,68,2,"_default"],[77,14,68,2],[77,17,68,2,"exports"],[77,24,68,2],[77,25,68,2,"default"],[77,32,68,2],[77,35,70,15,"fetchToWeb"],[77,45,70,25],[78,0,70,25],[78,3]],"functionMap":{"names":["<global>","getURLFromArgs","isFirstPartyURL","isSecondPartyURL","fetchWithHeaders"],"mappings":"AAA;uBCI;CDW;wBEE;CFK;yBGE;CHE;mBIE;CJuC"}},"type":"js/module"}]}